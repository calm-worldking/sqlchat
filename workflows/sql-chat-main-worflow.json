{
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "chat",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -740,
          560
        ],
        "id": "3e29f034-b47d-4b6d-bee3-a0b2208b296c",
        "name": "Webhook",
        "webhookId": "f305536a-f827-4c38-9b72-ace15bf3f3c1"
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "5KUIfkHx5RgYKMHv",
            "mode": "list",
            "cachedResultName": "My workflow 5"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "natural_language_query": "={{ $json.body.message }}",
              "sessionId": "={{ $json.body.sessionId }}",
              "contextLength": "={{ $json.body.settings.contextLength }}"
            },
            "matchingColumns": [
              "natural_language_query"
            ],
            "schema": [
              {
                "id": "natural_language_query",
                "displayName": "natural_language_query",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "sessionId",
                "displayName": "sessionId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "contextLength",
                "displayName": "contextLength",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "number",
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.2,
        "position": [
          -80,
          640
        ],
        "id": "36593f2c-1bf2-4036-8a74-bb8715ce9583",
        "name": "Execute Workflow"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {
            "responseFormat": "json_object"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          640,
          480
        ],
        "id": "156d4ee4-85cc-454b-b33a-6f4c873ee79a",
        "name": "OpenAI Chat Model1",
        "credentials": {
          "openAiApi": {
            "id": "ObyB9R5Nq3BsLRBQ",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "allIncomingItems",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.4,
        "position": [
          1640,
          1060
        ],
        "id": "9814db14-3bea-4153-ba17-f500790580c0",
        "name": "Respond to Webhook"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"Full_response_report\": {\n\t\t\t\"type\": \"string\"\n\t\t}\n\t}\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          880,
          480
        ],
        "id": "fb02f7a0-6cb1-43ee-9cea-40b22788bd30",
        "name": "Structured Output Parser"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "48383c24-e1cf-478d-9e8f-e2e30045df69",
                "name": "body",
                "value": "={{ $json.body }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -520,
          560
        ],
        "id": "e6ad1fa5-de9f-4fd7-b357-35dec0e1fa60",
        "name": "Params"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {
            "responseFormat": "json_object"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          280,
          1140
        ],
        "id": "3b562658-45b3-4455-8de0-a2bcea6d3924",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "ObyB9R5Nq3BsLRBQ",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "inputText": "={{ $('Params').item.json.body.message }}",
          "categories": {
            "categories": [
              {
                "category": "Text",
                "description": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç"
              },
              {
                "category": "Visual",
                "description": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤"
              },
              {
                "category": "Table",
                "description": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç–∞–±–ª—Ü"
              }
            ]
          },
          "options": {
            "multiClass": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1.1,
        "position": [
          280,
          910
        ],
        "id": "e6d5ce55-73af-4550-a3e3-2edac2c1e40c",
        "name": "Text Classifier"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=üîé –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n{{ $('Params').item.json.body.message }}\n\nüìä –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î:\n{{ $('Execute Workflow').item.json.sqloutput }}\n\n–°—Ñ–æ—Ä–º–∏—Ä—É–π –ø–æ–¥—Ä–æ–±–Ω—ã–π, –Ω–æ –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π –æ—Ç—á—ë—Ç, –ø–æ–Ω—è—Ç–Ω—ã–π —á–µ–ª–æ–≤–µ–∫—É, –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö.\n\n–û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.\n",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –æ—Ç—á—ë—Ç–æ–≤.\n\n–ù–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã (`sqloutput`) —Ç—ã —Ñ–æ—Ä–º–∏—Ä—É–µ—à—å –∫—Ä–∞—Ç–∫–∏–π, –ª–æ–≥–∏—á–Ω—ã–π –∏ —á–µ–ª–æ–≤–µ–∫–æ-–ø–æ–Ω—è—Ç–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç, —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É—è —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö.\n\n---\n\nüìå –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï:\n1. `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å` ‚Äî —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç, –∫–∞–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ö–æ—á–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —á–µ–ª–æ–≤–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, \"–°–∫–æ–ª—å–∫–æ –±—ã–ª–æ –∑–∞–∫–∞–∑–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü?\" –∏–ª–∏ \"–ì–¥–µ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?\").\n2. `sqloutput` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç SQL-–∑–∞–ø—Ä–æ—Å–∞ –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã (–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤). –≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.\n\n---\n\nüìå –¶–ï–õ–¨:\n–ù–∞ –æ—Å–Ω–æ–≤–µ `sqloutput` –∏ –∑–∞–ø—Ä–æ—Å–∞:\n- –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∫—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥;\n- –û–±—ä—è—Å–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–µ–Ω—ã, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞;\n- –ù–∏ –≤ –∫–æ–µ–º —Å–ª—É—á–∞–µ –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å —Ñ–∞–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ sqloutput.\n\n---\n\nüõë –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê:\n\n1. ‚ùó –ò—Å–ø–æ–ª—å–∑—É–π **—Ç–æ–ª—å–∫–æ** —Ñ–∞–∫—Ç—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ `sqloutput`.\n2. ‚ùó –ù–µ –¥–µ–ª–∞–π –æ–±–æ–±—â–µ–Ω–∏–π, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.\n3. ‚ùó –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã ‚Äî –¥–∞–π –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ–± —ç—Ç–æ–º.\n4. ‚ùó –í–æ–∑–≤—Ä–∞—â–∞–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç **—Å—Ç—Ä–æ–≥–æ –≤ JSON-—Ñ–æ—Ä–º–∞—Ç–µ** —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∏–¥–∞:\n\n```json\n{\n  \"Full_response_report\": \"...\"\n}\n5. ‚ùå –ù–µ –¥–æ–±–∞–≤–ª—è–π –Ω–∏–∫–∞–∫–∏—Ö –ø–æ—è—Å–Ω–µ–Ω–∏–π, markdown, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–≤ –≤–Ω–µ JSON.\n\n6. ‚ùå –ù–µ –ø–∏—à–∏ SQL-–∑–∞–ø—Ä–æ—Å—ã –∏ –Ω–µ —É–∫–∞–∑—ã–≤–∞–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥ –∞–Ω–∞–ª–∏–∑–∞.\n\n7. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–π –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö –º–æ–≥—É—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —á–∏—Å–ª–∞"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2,
        "position": [
          680,
          260
        ],
        "id": "66545a34-d697-4f64-850d-d599c7cfb6c9",
        "name": "Text Agent"
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{$('Params').item.json.body.sessionId}}",
          "contextWindowLength": "={{ $('Params').item.json.body.settings.contextLength }}"
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          760,
          480
        ],
        "id": "da0c6431-ed00-481e-a583-f297025b6c06",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {
            "responseFormat": "json_object"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          700,
          880
        ],
        "id": "981a7fa1-c0d6-4917-8bd8-c0178260d1f6",
        "name": "OpenAI Chat Model3",
        "credentials": {
          "openAiApi": {
            "id": "ObyB9R5Nq3BsLRBQ",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n \"r_script\": \"library(ggplot2)\\n\\ndata <- data.frame(\\n  city = c('–ê–ª–º–∞—Ç—ã', '–ê—Å—Ç–∞–Ω–∞', '–®—ã–º–∫–µ–Ω—Ç'),\\n  count = c(58, 42, 28)\\n)\\n\\nggplot(data, aes(x = city, y = count, fill = city)) +\\n  geom_bar(stat = 'identity') +\\n  labs(title = '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º', x = '–ì–æ—Ä–æ–¥', y = '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ') +\\n  theme_minimal()\"\n}\n"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          820,
          880
        ],
        "id": "65f1250f-e760-4f99-8d12-b3555c60f77e",
        "name": "Structured Output Parser2"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=üîé –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n{{ $('Params').item.json.body.message }}\n\nüìä –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î (–∫–∞–∂–¥—ã–π —Å—Ç–æ–ª–±–µ—Ü –≤ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ —Ä–∞–∑–¥–µ–ª—ë–Ω —Å–∏–º–≤–æ–ª–æ–º `|`):\n{{ $json.sqloutput }}\n\n–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π  R-script –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π ggplot2\n\n–û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.\n",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=# System Prompt: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–º (ggplot2)\n\n–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —è–∑—ã–∫–∞ R.\n\n–ù–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (`sqloutput`) —Ç—ã —Å–æ–∑–¥–∞—ë—à—å:\n\nüìå R-—Å–∫—Ä–∏–ø—Ç –Ω–∞ `ggplot2`, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ. –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `p`. –í–≤–µ—Ä—Ö—É –≥—Ä–∞—Ñ–∏–∫–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º.\n\n---\n\n## üìå –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï:\n- `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å` ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ö–æ—á–µ—Ç —É–≤–∏–¥–µ—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.\n- `sqloutput` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç SQL-–∑–∞–ø—Ä–æ—Å–∞ –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤.\n\n---\n\n## üìå –¶–ï–õ–¨:\n- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏—Ö –≤ –≤–∏–¥–µ –≥—Ä–∞—Ñ–∏–∫–∞, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å—É.\n- –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–π –∏ —ç—Å—Ç–µ—Ç–∏—á–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ `ggplot2`.\n\n---\n\n## üõë –ñ–Å–°–¢–ö–ò–ï –ü–†–ê–í–ò–õ–ê:\n0. –í—Å–µ–≥–¥–∞ –ø–æ–¥–∫–ª—é—á–∞–π `library(ggplot2)` –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞.\n1. ‚ùó –í—Å–µ –≤–µ–∫—Ç–æ—Ä—ã –≤ `data.frame(...)` –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –¥–ª–∏–Ω—É.\n2. ‚ùó –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–ª–∏ —Å–æ–∫—Ä–∞—â–∞–π –¥–∞–Ω–Ω—ã–µ (`/* ... */`, `...`, –∏ —Ç.–¥. ‚Äî –∑–∞–ø—Ä–µ—â–µ–Ω—ã).\n3. ‚ùó –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `sqloutput`.\n4. ‚ùó –°–æ—Ö—Ä–∞–Ω—è–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `p`.\n5. ‚ùó –ì—Ä–∞—Ñ–∏–∫ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ (`labs(title = ...)`) –∏ –ø–æ–¥–ø–∏—Å–∏ –æ—Å–µ–π.\n6. ‚ùó –°—Ç–æ–ª–±—Ü—ã –≤ —Ç–∞–±–ª–∏—Ü–µ –¥–æ–ª–∂–Ω—ã —Ä–∞–∑–¥–µ–ª—è—Ç—å—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–¥–ø–∏—Å–∏).\n7. ‚ùå –ù–µ –¥–æ–±–∞–≤–ª—è–π –ø–æ—è—Å–Ω–µ–Ω–∏–π, markdown, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–ª–∏ –≤—ã–≤–æ–¥–∞ –≤–Ω–µ JSON.\n8. –ù–∞ –≥—Ä–∞—Ñ–∏–∫–∞—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω–∞—è –ª–µ–≥–µ–Ω–¥–∞ –∏ –µ—Å–ª–∏ –Ω—É–∂–Ω—ã, —Ç–æ –ø–æ–¥–ø–∏—Å–∏ —É –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n9. ‚ùó –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n```json\n{\n  \"r_script\": \"...\"\n}\n```\n\n---\n\n## üìà –¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞:\n- –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí `geom_bar()`\n- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã ‚Üí `geom_line()`\n- –ü—Ä–æ—Ü–µ–Ω—Ç—ã/–¥–æ–ª–∏ ‚Üí `geom_bar()` + `coord_polar()`\n- 2D-–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ ‚Üí `geom_tile()`\n\n---\n\n## üìå –ï–°–õ–ò sqloutput –ü–£–°–¢–û–ô:\n```json\n{\n  \"r_script\": \"\"\n}\n```\n\n---\n\n## üìå –ü–†–ò–ú–ï–†:\n```json\n{\n  \"r_script\": \"library(ggplot2)\\ndata <- data.frame(city = c('–ê–ª–º–∞—Ç—ã', '–ê—Å—Ç–∞–Ω–∞', '–®—ã–º–∫–µ–Ω—Ç'), count = c(120, 85, 60))\\np <- ggplot(data, aes(x = city, y = count, fill = city)) + geom_bar(stat = 'identity') + labs(title = '–ö–ª–∏–µ–Ω—Ç—ã –ø–æ –≥–æ—Ä–æ–¥–∞–º', x = '–ì–æ—Ä–æ–¥', y = '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ') + theme_minimal()\"\n}\n```\n\n---\n\nüîö –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–≥–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON —Å –∫–ª—é—á–æ–º `r_script`."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2,
        "position": [
          680,
          660
        ],
        "id": "401b2128-95da-45b4-9c62-d448ab9757eb",
        "name": "Text Agent1"
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineByPosition",
          "options": {}
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          1250,
          910
        ],
        "id": "00634185-58b7-461b-a13e-545237cce47c",
        "name": "Merge"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {
            "responseFormat": "json_object"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          700,
          1580
        ],
        "id": "9b2b0f44-8600-4007-9cb6-1e4671b2b9aa",
        "name": "OpenAI Chat Model4",
        "credentials": {
          "openAiApi": {
            "id": "ObyB9R5Nq3BsLRBQ",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n \"r_script\": \"library(ggplot2)\\n\\ndata <- data.frame(\\n  city = c('–ê–ª–º–∞—Ç—ã', '–ê—Å—Ç–∞–Ω–∞', '–®—ã–º–∫–µ–Ω—Ç'),\\n  count = c(58, 42, 28)\\n)\\n\\nggplot(data, aes(x = city, y = count, fill = city)) +\\n  geom_bar(stat = 'identity') +\\n  labs(title = '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º', x = '–ì–æ—Ä–æ–¥', y = '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ') +\\n  theme_minimal()\"\n}\n"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          820,
          1580
        ],
        "id": "9a890c49-5886-4e9d-afb7-5c2931f5da1e",
        "name": "Structured Output Parser3"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=üîé –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n{{ $('Params').item.json.body.message }}\n\nüìä –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î (–∫–∞–∂–¥—ã–π —Å—Ç–æ–ª–±–µ—Ü –≤ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ —Ä–∞–∑–¥–µ–ª—ë–Ω —Å–∏–º–≤–æ–ª–æ–º `|`):\n{{ $json.sqloutput }}\n\n–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π  R-script –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π gt\n\n–û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.\n",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=# System Prompt: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü–µ–π (gt)\n\n–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—á–Ω–æ–π —Ñ–æ—Ä–º–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —è–∑—ã–∫–∞ R.\n\n–ù–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–∞–Ω–Ω—ã—Ö (`sqloutput`) —Ç—ã —Ñ–æ—Ä–º–∏—Ä—É–µ—à—å —Ç–∞–±–ª–∏—Ü—É —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `gt`, –∫–æ—Ç–æ—Ä–∞—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `p`. –¢–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏.\n\n---\n\n## üìå –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï:\n- `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å` ‚Äî –æ–±—ä—è—Å–Ω—è–µ—Ç, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.\n- `sqloutput` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç SQL-–∑–∞–ø—Ä–æ—Å–∞ –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤.\n\n---\n\n## üìå –¶–ï–õ–¨:\n- –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∑–∞–ø—Ä–æ—Å—É, –∏ –∫—Ä–∞—Å–∏–≤–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –µ—ë —Å –ø–æ–º–æ—â—å—é `gt`.\n\n---\n\n## üõë –ñ–Å–°–¢–ö–ò–ï –ü–†–ê–í–ò–õ–ê:\n0. –í—Å–µ–≥–¥–∞ –ø–æ–¥–∫–ª—é—á–∞–π `library(gt)` –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞.\n1. ‚ùó –í—Å–µ —Å—Ç–æ–ª–±—Ü—ã `data.frame(...)` –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –¥–ª–∏–Ω—É.\n2. ‚ùó –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ `sqloutput`. –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π –∑–Ω–∞—á–µ–Ω–∏—è.\n3. ‚ùó –¢–∞–±–ª–∏—Ü–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `p`.\n4. ‚ùó –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `tab_header()`.\n5. ‚ùó –°—Ç–æ–ª–±—Ü—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–∏—Å–ª–∞, –Ω–∞–∑–≤–∞–Ω–∏—è ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.\n6. ‚ùó –¢–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ —á–∏—Ç–∞–µ–º–æ–π.\n7. ‚ùó –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n```json\n{\n  \"r_script\": \"...\"\n}\n```\n8. ‚ùå –ù–µ –¥–æ–±–∞–≤–ª—è–π –ø–æ—è—Å–Ω–µ–Ω–∏–π, markdown, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ JSON.\n\n---\n\n## üìå –ï–°–õ–ò sqloutput –ü–£–°–¢–û–ô:\n```json\n{\n  \"r_script\": \"\"\n}\n```\n\n---\n\n## üìå –ü–†–ò–ú–ï–†:\n```json\n{\n  \"r_script\": \"library(gt)\\ndata <- data.frame(city = c('–ê–ª–º–∞—Ç—ã', '–ê—Å—Ç–∞–Ω–∞', '–®—ã–º–∫–µ–Ω—Ç'), count = c(120, 85, 60))\\np <- gt(data) |> tab_header(title = '–ö–ª–∏–µ–Ω—Ç—ã –ø–æ –≥–æ—Ä–æ–¥–∞–º')\"\n}\n```\n\n---\n\nüîö –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–≥–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON —Å –∫–ª—é—á–æ–º `r_script`."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2,
        "position": [
          680,
          1360
        ],
        "id": "b1622749-3cdf-4e1c-8df4-7331a8330449",
        "name": "Text Agent2"
      },
      {
        "parameters": {
          "mode": "raw",
          "jsonOutput": "{\n\"output\": \n{\n\"r_script\": \"\"\n}\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          750,
          1060
        ],
        "id": "948896af-2b5f-4de2-a422-68d215098d71",
        "name": "Edit Fields"
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Params",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute Workflow": {
        "main": [
          [
            {
              "node": "Text Agent",
              "type": "main",
              "index": 0
            },
            {
              "node": "Text Classifier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "Text Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "Text Agent",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Params": {
        "main": [
          [
            {
              "node": "Execute Workflow",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Text Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Text Classifier": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Text Agent1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Text Agent2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text Agent": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "Text Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model3": {
        "ai_languageModel": [
          [
            {
              "node": "Text Agent1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser2": {
        "ai_outputParser": [
          [
            {
              "node": "Text Agent1",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Text Agent1": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model4": {
        "ai_languageModel": [
          [
            {
              "node": "Text Agent2",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser3": {
        "ai_outputParser": [
          [
            {
              "node": "Text Agent2",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Text Agent2": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      }
    },
    "pinData": {},
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "229fcadd5d04276eaa7a3f397f6571c4439bac96b912fb0774d4e4f872a9b68c"
    }
  }